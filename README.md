# TravelBot Mini App

TravelBot — это мини‑приложение для Telegram, которое помогает
организовать поездки по всему миру. Оно запускается внутри
Telegram WebApp, определяет ваше местоположение, сохраняет ваши
предпочтения и генерирует пешеходные маршруты с помощью AI.

## Функции

- **Авторизация через Telegram.** Пользователь входит через Telegram,
  инициализация проверяется на сервере с помощью HMAC-подписи
  `initData`.
- **Профиль пользователя.** Выбираете предпочтения: кухни, виды
  развлечений, бюджет, стиль путешествий. Информация сохраняется в
  PostgreSQL и доступна на всех устройствах.
- **Определение местоположения.** Приложение использует
  `navigator.geolocation` и обратное геокодирование Яндекс, чтобы
  понять, находитесь ли вы в выбранном городе.
- **Маршруты «на месте».** AI (OpenAI) генерирует маршруты с
  подробным описанием точек. На сервере точки маршрута
  геокодируются, чтобы на карте Яндекса можно было отобразить линию
  маршрута.
- **Планирование поездок.** Выбираете город и даты. Приложение
  показывает прогноз погоды (OpenWeather) и советы по снаряжению.
  Можно выбрать достопримечательности, чтобы потом построить
  маршрут.
- **Мультиязычность.** Интерфейс поддерживает русский и английский
  языки. AI генерирует контент на языке пользователя.
- **Офлайн-режим.** Благодаря PWA и кэшированию последних маршрутов
  приложение продолжает работать без доступа к интернету.
- **Платежи (заготовка).** В проект заложен каркас для будущей
  интеграции Telegram Stars или провайдеров YooKassa/CloudPayments.

## Быстрый старт (локально)

1. Установите зависимости для клиента и сервера:

   ```bash
   cd travelbot/client && npm install
   cd ../server && npm install
   ```

2. Запустите PostgreSQL (например, через Docker Compose):

   ```bash
   docker compose -f docker-compose.dev.yml up -d
   ```

3. Мигрируйте базу и сгенерируйте Prisma client:

   ```bash
   cd server
   npx prisma migrate dev --name init
   npx prisma generate
   ```

4. Запустите сервер в режиме разработки:

   ```bash
   cd server
   npm run dev
   ```

5. Запустите клиент в режиме разработки:

   ```bash
   cd client
   npm run dev
   ```

6. Добавьте URL клиента в @BotFather в качестве WebApp URL.

7. Настройте файл `.env` согласно `.env.example` и перезапустите
   сервер.

## Деплой на Timeweb.Cloud

1. Соберите Docker-образ:

   ```bash
   docker build -t your-registry/travelbot .
   docker push your-registry/travelbot
   ```

2. Создайте приложение в Timeweb.Cloud, подключите репозиторий или
   скачайте образ. Укажите переменные окружения (BOT_TOKEN, etc).

3. Используйте Managed PostgreSQL или укажите адрес своей базы.

4. Разверните и проверьте в Telegram. После проверки можно добавить
   поддержку платежей.

## Структура проекта

См. комментарии в исходниках для подробностей. Вкратце: в каталоге
`client/` — фронтенд на React; в `server/` — бэкенд на Express.
Dockerfile собирает фронтенд и помещает его в директорию `dist_client`
у сервера.